---
trigger: model_decision
description: USE WHEN writing or modifying documentation or diagrams; enforce synchronization with code, auto-generation markers, pipeline doc format, and diagramming policy
globs: ["docs/**/*.md", "docs/**/diagrams/**/*.mmd", "docs/**/diagrams/**/*.puml", "**/INDEX.md", "**/README.md"]
---

# Documentation Standards

## Synchronization (Mandatory)

- Documentation MUST be synchronized with code and schemas
- Any change to public contracts, ABCs, Default factories, Impl, or pipeline config MUST be reflected in docs in the same PR
- Breaking changes MUST be recorded in `CHANGELOG.md`

## Auto-Generation

- Auto-generated sections MUST be marked: `<!-- generated -->`
- Auto-generated sections MUST NOT be edited manually
- Generator and timestamp MUST be recorded in autogenerated block

## Pipeline Docs

- Format: `NN-<entity>-<provider>-<topic>.md` in `docs/application/pipelines/<provider>/<entity>/`
- H1 heading MUST duplicate filename in Title Case
- Internal anchors from `##` headings in kebab-case
- Relative links MUST pass link-checker

## New Entity Documentation

When adding a new entity (contract/pipeline/client), PR MUST include:
1. Documentation under `docs/application/pipelines/<provider>/<entity>/` using `NN-<entity>-<provider>-<topic>.md`
2. Entry/update in `docs/domain/abc/00-index.md` if ABC/contract is added
3. Updates to `src/bioetl/infrastructure/clients/base/abc_registry.yaml` and `src/bioetl/infrastructure/clients/base/abc_impls.yaml` when creating ABC/Default/Impl

## Architecture & Pipeline Diagrams

- Diagrams are part of architecture documentation and MUST be kept in sync with code and pipeline behavior
- Primary storage:
  - `docs/architecture/diagrams/`
  - `docs/pipelines/<provider>/<entity>/diagrams/`
- Primary format is text (Mermaid/PlantUML). PRs touching diagrams MUST include source files (`*.mmd`, `*.puml`). PNG/SVG are allowed mirrors only
- Filenames MUST use kebab-case, one file per diagram (e.g. `activity-chembl-class.mmd`, `activity-chembl-sequence-full-run.mmd`, `pipeline-run-error-flowchart.mmd`)
- For each production pipeline, the minimal required set is:
  1. Flowchart of the overall workflow
  2. Sequence diagram of the main scenario (extract → transform → validate → write)
  3. Class diagram if custom models or abstractions exist
- Any change to architecture, protocols, pipelines, or API clients MUST be reflected in diagrams in the same PR; missing or stale diagrams for such changes is a PR blocker
- Each PR touching architecture or pipelines MUST explicitly state whether Class/Sequence/Flowchart updates are needed; if "yes", updated diagram files MUST be present in the diff

## Examples

Valid:
- `docs/application/pipelines/chembl/activity/01-activity-chembl-extract.md`
- `docs/application/pipelines/chembl/activity/02-activity-chembl-transform.md`
- `docs/INDEX.md`
- `docs/02-pipelines/README.md`

Invalid:
- `docs/application/pipelines/chembl/activity/extraction.md` (missing NN- prefix)
- `docs/application/pipelines/Chembl/Activity/Extraction.md` (uppercase, underscores)

## Reference

See `docs/project/00-rules-summary.md` (раздел 1 — именование документации, раздел 4 — стандарты документации) for detailed standards.
