# 00 Pipeline Base

## Описание

PipelineBase — абстрактный базовый класс табличного ETL-пайплайна. Оркестрирует стадии extract-transform-validate-write, обеспечивая единый интерфейс, логирование, валидацию (через Pandera) и атомарную запись результатов. Также централизованно управляет ресурсами (например, закрывает подключения) и поддерживает dry_run режим без записи.

Пайплайн обеспечивает детерминированное выполнение: фиксированный порядок колонок/строк, UTC-время, каноническая сериализация. Результаты записываются атомарно (temp → os.replace) для обеспечения целостности данных.

## Модуль

`src/bioetl/core/pipeline_base.py`

## Основные методы

### `run(output: Path) -> RunResult`

Запускает пайплайн и записывает результат в указанный путь. Выполняет последовательность стадий:
1. **extract**: извлечение сырых данных из API, файлов и преобразование в DataFrame
2. **transform**: трансформация, обогащение, валидация данных
3. **validate**: проверка структуры данных по Pandera-схеме, добавление хэш-строк при необходимости
4. **write**: запись результата в Parquet с атомарной операцией

Возвращает `RunResult` с информацией о количестве обработанных записей, времени выполнения и метаданных.

### `dry_run() -> RunResult`

Выполняет пайплайн без записи результатов. Полезен для проверки конфигурации, валидации данных и оценки производительности без фактической записи файлов.

## Функциональность

- **Единый интерфейс**: стандартизированный способ выполнения ETL-пайплайнов
- **Логирование**: интеграция с LoggerAdapterABC для структурированного логирования событий
- **Валидация**: автоматическая проверка данных по Pandera-схемам перед записью
- **Атомарная запись**: гарантия целостности данных через временные файлы
- **Управление ресурсами**: автоматическое закрытие подключений и освобождение ресурсов стадий
- **Dry-run режим**: возможность тестирования без записи результатов

## Управление ресурсами

Пайплайн централизованно управляет жизненным циклом ресурсов:
- Вызывает `dispose()` на всех стадиях после завершения
- Закрывает подключения к внешним источникам данных
- Освобождает кэши и временные ресурсы
- Гарантирует корректное завершение даже при ошибках

## Related Components

- **StageABC**: стадии пайплайна (extract, transform, validate, write)
- **PipelineHookABC**: хуки для мониторинга выполнения
- **ErrorPolicyABC**: политика обработки ошибок
- **LoggerAdapterABC**: структурированное логирование
- **SchemaProviderABC**: поставка схем для валидации
- **WriterABC**: запись результатов в хранилище

