# 01 Rate Limiter

## Описание

`TokenBucketRateLimiterImpl` — реализация лимитера частоты запросов с алгоритмом токен-бакета. Ограничивает скорость обращений к внешним API, поддерживает блокирующее и неблокирующее получение токена.

## Модуль

`src/bioetl/core/http/rate_limiter.py`

## Наследование

Лимитер реализует интерфейс `RateLimiterABC` и предоставляет реализацию алгоритма токен-бакета.

## Алгоритм токен-бакета

Алгоритм работает следующим образом:
- Токены добавляются в бакет с фиксированной скоростью
- Каждый запрос потребляет один токен
- Если токенов нет, запрос блокируется или отклоняется

## Основные методы

### `try_acquire(self) -> bool`

Пытается получить токен без блокировки. Возвращает `True`, если токен получен, и `False` в противном случае.

**Возвращает:** `True` если токен получен, `False` если токенов нет.

### `acquire(self, *, timeout: Optional[float] = None) -> bool`

Получает токен с возможностью блокировки до истечения таймаута.

**Параметры:**
- `timeout` — максимальное время ожидания токена в секундах (опционально)

**Возвращает:** `True` если токен получен, `False` если таймаут истёк.

## Использование

Лимитер используется HTTP-клиентами для контроля частоты запросов к внешним API:

```python
if rate_limiter.try_acquire():
    response = make_request()
else:
    # Ожидание или пропуск запроса
    rate_limiter.acquire(timeout=5.0)
    response = make_request()
```

## Related Components

- **RateLimiterABC**: интерфейс лимитера частоты (см. `docs/reference/abc/16-rate-limiter-abc.md`)
- **RequestsBackend**: использует лимитер для контроля частоты запросов (см. `docs/02-pipelines/chembl/common/03-chembl-requests-backend.md`)

