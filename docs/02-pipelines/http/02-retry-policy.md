# 02 Retry Policy

## Описание

`ExponentialBackoffRetryImpl` — реализация стратегии повторных попыток с экспоненциальной задержкой. Вычисляет интервал перед следующей попыткой с учётом случайного джиттера и максимального порога задержки.

## Модуль

`src/bioetl/core/http/retry.py`

## Наследование

Политика реализует интерфейс `RetryPolicyABC` и предоставляет реализацию экспоненциального backoff.

## Алгоритм экспоненциального backoff

Алгоритм работает следующим образом:
- Задержка увеличивается экспоненциально с каждой попыткой
- Добавляется случайный джиттер для предотвращения thundering herd
- Устанавливается максимальный порог задержки

## Основной метод

### `compute_backoff(self, attempt: int, retry_after: float | None = None) -> float`

Вычисляет интервал задержки перед следующей попыткой.

**Параметры:**
- `attempt` — номер попытки (начинается с 1)
- `retry_after` — рекомендуемая задержка из заголовка Retry-After (опционально)

**Возвращает:** интервал задержки в секундах.

**Формула:**
```
delay = min(base_delay * (2 ** (attempt - 1)) + jitter, max_delay)
```

## Случайный джиттер

Джиттер добавляется для:
- Предотвращения одновременных повторных запросов
- Распределения нагрузки на сервер
- Улучшения стабильности системы

## Related Components

- **RetryPolicyABC**: интерфейс политики повторных попыток (см. `docs/reference/abc/19-retry-policy-abc.md`)
- **RequestsBackend**: использует политику для обработки ошибок (см. `docs/02-pipelines/chembl/common/03-chembl-requests-backend.md`)

