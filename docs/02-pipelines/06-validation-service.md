# 06 Validation Service

## Описание

`DefaultValidationService` — сервис валидации данных пайплайна по схеме. Обёртка вокруг Pandera-схемы, используемая для проверки соответствия DataFrame ожидаемому формату и для выдачи пустого DataFrame при необходимости. В данном пайплайне применяется, например, для возвращения пустого результата, если стратегия извлечения ничего не вернула, либо для предупреждения о дрейфе схемы (может подавлять исключения схемы).

## Модуль

`bioetl/core/pipeline/services`

## Основные методы

### `empty_frame(self) -> pd.DataFrame`

Возвращает пустой DataFrame согласно схеме – со всеми требуемыми колонками, но без строк.

**Использование:**
- Используется стратегиями извлечения как запасной результат в случае отсутствия данных
- Обеспечивает корректную структуру DataFrame даже при отсутствии данных

**Возвращает:** пустой DataFrame с колонками согласно схеме.

### `validate(self, df: pd.DataFrame) -> pd.DataFrame`

Валидирует DataFrame с помощью встроенной Pandera-схемы.

**Параметры:**
- `df` — DataFrame для валидации

**Процесс валидации:**

1. Проверка схемы: валидация DataFrame по Pandera-схеме
2. Обработка ошибок: выбрасывание ошибки при несовпадении или предупреждение при разрешённом дрейфе схемы
3. Возврат результата: возврат исходного `df` при успешной валидации или при подавлении ошибок

**Возвращает:** валидированный DataFrame.

**Обработка дрейфа схемы:**

- Если дрейф схемы разрешён, сервис может предупреждать о несовпадениях, но не прерывать выполнение
- Если дрейф схемы запрещён, выбрасывается исключение при несовпадении

## Использование

Сервис используется внутри `UnifiedOutputWriter` через метод `validate_with_schema` для валидации данных перед записью.

## Related Components

- **UnifiedOutputWriter**: использует сервис для валидации данных (см. `docs/02-pipelines/04-unified-output-writer.md`)
- **SchemaRegistry**: предоставляет схемы для валидации (см. `docs/02-pipelines/05-schema-registry.md`)
- **ChEMBLActivitySchema**: Pandera-схема для валидации данных активности (см. `docs/02-pipelines/chembl/activity/12-activity-chembl-schema.md`)

