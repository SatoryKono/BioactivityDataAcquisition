# Отчёт о содержательном аудите документации

## Сводка

Документация проекта BioETL находится в состоянии **спецификации/ТЗ** для будущей реализации. Код отсутствует, что делает документацию единственным источником истины о проектируемой системе. 

**Текущее состояние:**
- Документация хорошо структурирована по разделам (overview, guides, reference, architecture)
- Описаны ключевые компоненты (PipelineBase, ABC-контракты, клиенты, схемы)
- Есть руководства для разработчиков (добавление пайплайнов, ABC)
- Присутствуют архитектурные решения и roadmap

**Основные проблемы:**
- **Дублирование описаний**: одни и те же концепции (PipelineBase, ABC-паттерн, конфигурация) описаны в разных местах с разной детализацией
- **Неполнота end-to-end сценариев**: нет целостного описания жизненного цикла данных от API до артефактов
- **Смешение аудиторий**: документы не всегда явно разделены по целевой аудитории (новичок vs core-разработчик)
- **Противоречия в путях**: разные документы ссылаются на одни и те же компоненты через разные пути (`docs/reference/core/` vs `docs/02-pipelines/`)
- **Отсутствие явных контрактов**: не всегда ясно, что является стабильным API, а что — экспериментальным дизайном

**Главные направления рефакторинга:**
1. Консолидация описаний базовых концепций в единые разделы
2. Создание явных разделов по аудиториям (Getting Started для новичков, Reference для разработчиков)
3. Добавление end-to-end сценариев и примеров использования
4. Нормализация путей и ссылок между документами
5. Явное маркирование стабильных контрактов vs экспериментальных дизайнов

---

## Классификация существующих документов

| Файл/раздел | Тип документа | Аудитория | Уровень (обзор/детали) | Комментарий |
|-------------|---------------|-----------|------------------------|-------------|
| `README.md` | Обзор/навигация | Все | Обзор | Хорошая точка входа, но ссылки на несуществующие разделы |
| `docs/overview/getting-started.md` | Руководство пользователя | Новички | Концептуальный | Краткий, но неполный (нет реальных примеров, так как код отсутствует) |
| `docs/overview/architecture-overview.md` | Архитектурное описание | Разработчики | Логический | Высокоуровневое, но не хватает деталей потоков данных |
| `docs/overview/glossary.md` | Терминология | Все | Концептуальный | Хороший, но неполный (нет многих терминов из документации) |
| `docs/guides/adding-new-pipeline.md` | Руководство разработчика | Core-разработчики | Технический | Полезно, но ссылается на несуществующие пути (`docs/reference/pipelines/`) |
| `docs/guides/adding-new-abc.md` | Руководство разработчика | Core-разработчики | Технический | Хорошо структурировано, но примеры кода не проверяемы |
| `docs/guides/running-pipelines.md` | Руководство пользователя | Пользователи/DevOps | Концептуальный | Описывает концептуальные команды, но не реальные (код отсутствует) |
| `docs/guides/configuration.md` | Руководство пользователя | Пользователи/DevOps | Логический | Хорошо описывает концепцию профилей, но нет примеров реальных конфигов |
| `docs/02-pipelines/00-pipeline-base.md` | Спецификация API | Разработчики | Технический | Детальное описание интерфейса, но нет примеров использования |
| `docs/02-pipelines/chembl/activity/00-activity-chembl-overview.md` | Спецификация пайплайна | Разработчики | Технический | Подробно, но смешивает описание интерфейса и реализации |
| `docs/reference/abc/00-business-key-deriver-abc.md` | Спецификация контракта | Разработчики | Технический | Чёткий контракт, но нет примеров использования |
| `docs/cli/00-cli-overview.md` | Архитектурное описание | Разработчики | Логический | Описывает архитектуру CLI, но команды концептуальные |
| `docs/project/00-rules-summary.md` | Правила проекта | Все разработчики | Концептуальный/Технический | Хорошая сводка, но ссылается на несуществующие файлы |
| `docs/architecture/00-duplication-reduction-roadmap.md` | Архитектурное решение | Архитекторы/Core-разработчики | Логический | Полезный roadmap, но статусы не соответствуют реальности (исправлено) |
| `docs/architecture/01-config-fields-reuse.md` | Архитектурное решение | Архитекторы | Логический | Новый документ с рекомендациями |

---

## Карта тем и покрытие

| Тема | Где описана | Полнота | Дубли/конфликты | Комментарий |
|------|-------------|---------|-----------------|-------------|
| **Цель проекта** | `README.md`, `docs/overview/index.md` | Частично | Дублирование | Одинаковый текст в двух местах |
| **Архитектура пайплайнов** | `docs/overview/architecture-overview.md`, `docs/02-pipelines/00-pipeline-base.md`, `docs/02-pipelines/chembl/common/05-chembl-base-pipeline.md` | Полно | Дублирование | PipelineBase описан в 3 местах с разной детализацией |
| **ABC-паттерн** | `docs/guides/adding-new-abc.md`, `docs/project/00-rules-summary.md`, `.cursor/rules/11-abc-default-impl-policy.mdc` | Полно | Дублирование | Один паттерн описан в 3 местах |
| **Конфигурация** | `docs/guides/configuration.md`, `docs/02-pipelines/02-logging-and-configuration.md`, `configs/README.md` | Частично | Дублирование | Конфигурация описана в 3 местах, но нет единого описания всех возможностей |
| **Логирование** | `docs/02-pipelines/02-logging-and-configuration.md`, упоминания в других документах | Частично | Нет конфликтов | Описано в одном месте, но неполно (нет примеров) |
| **Клиенты внешних API** | `docs/02-pipelines/01-base-external-data-client.md`, `docs/02-pipelines/clients/06-clients-overview.md`, `docs/02-pipelines/03-unified-api-client.md` | Частично | Противоречие | BaseExternalDataClient помечен как deprecated, но неясно, что использовать вместо |
| **Схемы данных** | `docs/02-pipelines/schemas/05-schemas-registry-overview.md`, упоминания в пайплайнах | Частично | Нет конфликтов | Описано концептуально, но нет примеров схем |
| **Валидация** | `docs/02-pipelines/06-validation-service.md`, упоминания в PipelineBase | Частично | Нет конфликтов | Описано поверхностно |
| **Запись результатов** | `docs/02-pipelines/04-unified-output-writer.md`, упоминания в пайплайнах | Частично | Нет конфликтов | Описано концептуально |
| **ChEMBL-специфичные компоненты** | `docs/02-pipelines/chembl/common/*.md` (15 файлов) | Полно | Нет конфликтов | Хорошо документировано, но много файлов |
| **CLI** | `docs/cli/00-cli-overview.md`, упоминания в guides | Частично | Нет конфликтов | Описано архитектурно, но нет примеров команд |
| **Терминология** | `docs/overview/glossary.md` | Неполно | Нет конфликтов | Много терминов из документации отсутствуют в глоссарии |
| **Правила именования** | `docs/project/00-rules-summary.md`, `.cursor/rules/*.mdc` | Полно | Дублирование | Правила описаны в нескольких местах |
| **Детерминизм** | Упоминания в правилах, PipelineBase, roadmap | Частично | Нет конфликтов | Концепция описана, но нет детального объяснения требований |
| **Профили конфигураций** | `docs/guides/configuration.md`, `configs/profiles/*.yaml` | Полно | Нет конфликтов | Хорошо документировано |
| **Снижение дублирования** | `docs/architecture/00-duplication-reduction-roadmap.md`, `docs/project/04-architecture-and-duplication-reduction.md` | Полно | Дублирование | Roadmap и принципы описывают одно и то же |

---

## Основные проблемы и дубли

### Дубли

1. **Описание PipelineBase в трёх местах:**
   - `docs/overview/architecture-overview.md` — концептуально
   - `docs/02-pipelines/00-pipeline-base.md` — технически детально
   - `docs/02-pipelines/chembl/common/05-chembl-base-pipeline.md` — специфично для ChEMBL
   - **Решение**: Оставить детальное описание в `00-pipeline-base.md`, в остальных местах — ссылки

2. **ABC-паттерн описан в трёх местах:**
   - `docs/guides/adding-new-abc.md` — пошаговое руководство
   - `docs/project/00-rules-summary.md` — краткая сводка
   - `.cursor/rules/11-abc-default-impl-policy.mdc` — детальные правила
   - **Решение**: Определить иерархию: `.cursor/rules/` — источник истины, остальные — ссылки/сводки

3. **Конфигурация описана в трёх местах:**
   - `docs/guides/configuration.md` — пользовательское руководство
   - `docs/02-pipelines/02-logging-and-configuration.md` — техническое описание
   - `configs/README.md` — описание структуры файлов
   - **Решение**: Разделить: guides — для пользователей, reference — для разработчиков, configs/README — структура

4. **Цель проекта дублируется:**
   - `README.md` и `docs/overview/index.md` содержат идентичный текст
   - **Решение**: Оставить в README, в overview — ссылка

### Противоречия

1. **Пути к документации:**
   - `docs/guides/adding-new-pipeline.md` ссылается на `docs/reference/pipelines/`
   - Фактически документация в `docs/02-pipelines/`
   - **Решение**: Унифицировать пути (использовать `docs/02-pipelines/`)

2. **Статус BaseExternalDataClient:**
   - Помечен как deprecated в `docs/02-pipelines/01-base-external-data-client.md`
   - Но неясно, что использовать вместо (UnifiedAPIClient или BaseClient?)
   - **Решение**: Явно указать миграционный путь и целевой компонент

3. **Описание CLI:**
   - `docs/cli/00-cli-overview.md` описывает архитектуру
   - `docs/guides/running-pipelines.md` описывает использование
   - Но команды концептуальные, не реальные
   - **Решение**: Явно пометить как "концептуальные команды для будущей реализации"

### Пробелы

1. **End-to-end сценарии:**
   - Нет описания полного цикла: от запуска CLI до получения артефактов
   - Нет примеров реальных запусков (код отсутствует)
   - **Решение**: Добавить раздел "End-to-End Examples" с концептуальными сценариями

2. **Терминология:**
   - `docs/overview/glossary.md` неполный
   - Много терминов из документации отсутствуют (descriptor, batch plan, extraction strategy и др.)
   - **Решение**: Расширить глоссарий

3. **Примеры использования:**
   - Нет примеров реального кода (код отсутствует)
   - Нет примеров конфигураций для разных сценариев
   - **Решение**: Добавить раздел "Conceptual Examples" с псевдокодом

4. **Разделение по аудиториям:**
   - Нет явного разделения: что читать новичку, что core-разработчику
   - **Решение**: Создать разделы "For Newcomers" и "For Core Developers"

5. **Контракты vs дизайн:**
   - Неясно, что является стабильным контрактом, а что — экспериментальным дизайном
   - **Решение**: Ввести маркировку: `[CONTRACT]` для стабильных API, `[DESIGN]` для экспериментальных

6. **Обработка ошибок:**
   - Упоминается ErrorPolicyABC, но нет описания типичных ошибок и способов их обработки
   - **Решение**: Добавить раздел "Error Handling Patterns"

### Черновые/устаревшие разделы

1. **`docs/02-pipelines/01-base-external-data-client.md`:**
   - Помечен как deprecated, но всё ещё в основной документации
   - **Решение**: Переместить в `docs/archive/` или явно указать миграционный путь

2. **Ссылки на несуществующие разделы:**
   - Много ссылок на `docs/reference/core/` вместо `docs/02-pipelines/`
   - **Решение**: Исправить все ссылки (частично уже исправлено)

---

## Целевая структура содержания

### 1. **Overview (docs/overview/)**
**Назначение:** Введение в проект для всех аудиторий

**Текущие материалы:**
- `index.md` — обзор (дублирует README)
- `getting-started.md` — быстрый старт
- `architecture-overview.md` — архитектура
- `glossary.md` — терминология

**Что нужно:**
- Объединить `index.md` и `getting-started.md` в единый "Overview"
- Расширить `glossary.md` (добавить все термины из документации)
- Добавить раздел "For Newcomers" с навигацией по документации

**Новая структура:**
- `00-overview.md` — обзор проекта, цели, ключевые концепции
- `01-getting-started.md` — быстрый старт (концептуальный, так как код отсутствует)
- `02-architecture-overview.md` — высокоуровневая архитектура
- `03-glossary.md` — полный глоссарий терминов
- `04-navigation.md` — навигация по документации для разных аудиторий

### 2. **Guides (docs/guides/)**
**Назначение:** Практические руководства для пользователей и разработчиков

**Текущие материалы:**
- `adding-new-pipeline.md` — создание пайплайна
- `adding-new-abc.md` — создание ABC
- `running-pipelines.md` — запуск пайплайнов
- `configuration.md` — конфигурация
- `troubleshooting.md` — решение проблем

**Что нужно:**
- Разделить на "User Guides" и "Developer Guides"
- Добавить "End-to-End Examples" с концептуальными сценариями
- Расширить `troubleshooting.md` (типичные ошибки, решения)

**Новая структура:**
- `user/01-running-pipelines.md` — запуск пайплайнов (для пользователей)
- `user/02-configuration.md` — конфигурация (для пользователей)
- `user/03-troubleshooting.md` — решение проблем
- `developer/01-adding-new-pipeline.md` — создание пайплайна
- `developer/02-adding-new-abc.md` — создание ABC
- `developer/03-end-to-end-examples.md` — примеры полных сценариев
- `developer/04-error-handling-patterns.md` — паттерны обработки ошибок

### 3. **Reference (docs/reference/ или docs/02-pipelines/)**
**Назначение:** Детальная техническая документация компонентов

**Текущие материалы:**
- `docs/02-pipelines/00-pipeline-base.md` — базовый пайплайн
- `docs/02-pipelines/03-unified-api-client.md` — API клиент
- `docs/02-pipelines/04-unified-output-writer.md` — writer
- `docs/reference/abc/*.md` — ABC контракты
- `docs/02-pipelines/chembl/*.md` — ChEMBL пайплайны

**Что нужно:**
- Унифицировать пути (использовать `docs/02-pipelines/` для pipeline docs)
- Добавить маркировку контрактов vs дизайна
- Добавить примеры использования для каждого компонента

**Новая структура:**
- `core/00-pipeline-base.md` — базовый пайплайн [CONTRACT]
- `core/03-unified-api-client.md` — API клиент [CONTRACT]
- `core/04-unified-output-writer.md` — writer [CONTRACT]
- `abc/INDEX.md` — каталог ABC [CONTRACT]
- `abc/NN-*.md` — ABC контракты [CONTRACT]
- `pipelines/chembl/*.md` — ChEMBL пайплайны [CONTRACT]
- `clients/*.md` — клиенты внешних API [CONTRACT]

### 4. **Architecture (docs/architecture/)**
**Назначение:** Архитектурные решения и дизайн

**Текущие материалы:**
- `00-duplication-reduction-roadmap.md` — roadmap
- `01-config-fields-reuse.md` — рекомендации по конфигам

**Что нужно:**
- Объединить roadmap и принципы снижения дублирования
- Добавить раздел "Design Decisions" с ADR-подобными записями

**Новая структура:**
- `00-architecture-decisions.md` — ключевые архитектурные решения
- `01-duplication-reduction.md` — принципы и roadmap снижения дублирования
- `02-config-fields-reuse.md` — рекомендации по конфигам

### 5. **Project Rules (docs/project/)**
**Назначение:** Правила проекта, стандарты кодирования

**Текущие материалы:**
- `00-rules-summary.md` — сводка правил
- `04-architecture-and-duplication-reduction.md` — принципы

**Что нужно:**
- Оставить только сводку правил
- Перенести архитектурные принципы в `docs/architecture/`

**Новая структура:**
- `00-rules-summary.md` — сводка всех правил (единственный источник истины)

---

## План контентного рефакторинга

### Этап 1: Консолидация базовых концепций (критично)

1. **Объединить описания PipelineBase:**
   - Оставить детальное описание в `docs/02-pipelines/00-pipeline-base.md`
   - В `docs/overview/architecture-overview.md` оставить только ссылку и краткое описание
   - В `docs/02-pipelines/chembl/common/05-chembl-base-pipeline.md` ссылаться на базовый класс
   - **Эффект**: Единый источник истины для PipelineBase

2. **Консолидировать ABC-паттерн:**
   - Определить `.cursor/rules/11-abc-default-impl-policy.mdc` как источник истины
   - В `docs/project/00-rules-summary.md` оставить краткую сводку со ссылкой
   - В `docs/guides/adding-new-abc.md` ссылаться на правила
   - **Эффект**: Единое описание паттерна

3. **Разделить конфигурацию по аудиториям:**
   - `docs/guides/user/02-configuration.md` — для пользователей (как использовать профили)
   - `docs/02-pipelines/02-logging-and-configuration.md` — для разработчиков (технические детали)
   - `configs/README.md` — структура файлов
   - **Эффект**: Чёткое разделение по аудиториям

### Этап 2: Исправление путей и ссылок (критично)

4. **Унифицировать пути к документации:**
   - Заменить все ссылки на `docs/reference/pipelines/` на `docs/02-pipelines/`
   - Заменить все ссылки на `docs/reference/core/` на `docs/02-pipelines/` (где применимо)
   - Обновить все внутренние ссылки в документах
   - **Эффект**: Нет битых ссылок, единообразные пути

5. **Исправить ссылки на несуществующие файлы:**
   - Все ссылки на `docs/00-styleguide/` заменить на актуальные пути
   - Все ссылки на `docs/ABC_INDEX.md` заменить на `docs/reference/abc/INDEX.md`
   - **Эффект**: Все ссылки работают

### Этап 3: Заполнение пробелов (высокий приоритет)

6. **Расширить глоссарий:**
   - Добавить все термины из документации (descriptor, batch plan, extraction strategy, business key и др.)
   - Добавить ссылки на документы, где термины описаны детально
   - **Эффект**: Полный справочник терминов

7. **Добавить end-to-end примеры:**
   - Создать `docs/guides/developer/03-end-to-end-examples.md`
   - Описать концептуальные сценарии: запуск пайплайна, обработка ошибок, валидация
   - Использовать псевдокод, так как реальный код отсутствует
   - **Эффект**: Понимание полного цикла работы системы

8. **Добавить раздел "For Newcomers":**
   - Создать `docs/overview/04-navigation.md`
   - Описать, что читать в зависимости от роли (новичок, разработчик, пользователь)
   - Добавить learning path
   - **Эффект**: Легкий старт для новых участников

9. **Добавить маркировку контрактов:**
   - В начале каждого reference-документа добавить `[CONTRACT]` или `[DESIGN]`
   - `[CONTRACT]` — стабильный API, нельзя ломать без обновления документации
   - `[DESIGN]` — экспериментальный дизайн, может измениться
   - **Эффект**: Ясность, что является стабильным, а что — экспериментальным

### Этап 4: Реорганизация структуры (средний приоритет)

10. **Разделить guides на user/developer:**
    - Переместить `running-pipelines.md`, `configuration.md`, `troubleshooting.md` в `guides/user/`
    - Переместить `adding-new-pipeline.md`, `adding-new-abc.md` в `guides/developer/`
    - Обновить все ссылки
    - **Эффект**: Чёткое разделение по аудиториям

11. **Объединить roadmap и принципы:**
    - Перенести содержимое `docs/project/04-architecture-and-duplication-reduction.md` в `docs/architecture/01-duplication-reduction.md`
    - Удалить дублирование между roadmap и принципами
    - **Эффект**: Единый документ по снижению дублирования

12. **Обработать deprecated компоненты:**
    - Переместить `docs/02-pipelines/01-base-external-data-client.md` в `docs/archive/` или явно указать миграционный путь
    - Добавить раздел "Migration Guide" с описанием перехода на UnifiedAPIClient
    - **Эффект**: Ясность по устаревшим компонентам

### Этап 5: Улучшение качества (низкий приоритет)

13. **Добавить примеры использования:**
    - В каждый reference-документ добавить раздел "Usage Examples" с псевдокодом
    - В guides добавить больше концептуальных примеров
    - **Эффект**: Лучшее понимание использования компонентов

14. **Добавить раздел "Error Handling Patterns":**
    - Создать `docs/guides/developer/04-error-handling-patterns.md`
    - Описать типичные ошибки и способы их обработки
    - Связать с ErrorPolicyABC
    - **Эффект**: Понимание обработки ошибок

15. **Нормализовать стиль документов:**
    - Единый формат заголовков
    - Единый формат примеров кода
    - Единый формат ссылок
    - **Эффект**: Единообразная документация

---

## Задел под будущий код

### Источники истины для архитектуры и API

**Стабильные контракты (помечены `[CONTRACT]`):**

1. **ABC-контракты** (`docs/reference/abc/*.md`):
   - Определяют интерфейсы компонентов
   - **Правило**: Изменение ABC требует обновления документации и всех реализаций
   - **Синхронизация**: При изменении ABC обновлять:
     - Документацию ABC
     - `abc_registry.yaml`
     - `abc_impls.yaml`
     - Все реализации (Impl)

2. **PipelineBase API** (`docs/02-pipelines/00-pipeline-base.md`):
   - Определяет базовый интерфейс пайплайнов
   - **Правило**: Изменение публичных методов требует обновления документации
   - **Синхронизация**: При изменении API обновлять:
     - Документацию PipelineBase
     - Все подклассы (ChemblBasePipeline и др.)
     - Тесты

3. **UnifiedAPIClient API** (`docs/02-pipelines/03-unified-api-client.md`):
   - Определяет интерфейс унифицированного клиента
   - **Правило**: Изменение публичных методов требует обновления документации
   - **Синхронизация**: При изменении API обновлять:
     - Документацию UnifiedAPIClient
     - Все использования в пайплайнах
     - Тесты

4. **Схемы данных** (`docs/02-pipelines/schemas/*.md`):
   - Определяют структуру данных
   - **Правило**: Изменение схемы требует обновления документации и версионирования
   - **Синхронизация**: При изменении схемы обновлять:
     - Документацию схемы
     - Pandera-схемы в коде
     - Тесты
     - CHANGELOG.md

**Экспериментальные дизайны (помечены `[DESIGN]`):**

1. **Архитектурные решения** (`docs/architecture/*.md`):
   - Описывают дизайн, который может измениться
   - **Правило**: Изменения не требуют обновления всех реализаций сразу
   - **Синхронизация**: При реализации обновлять статус с `[DESIGN]` на `[CONTRACT]`

2. **Roadmap** (`docs/architecture/00-duplication-reduction-roadmap.md`):
   - План реализации, может изменяться
   - **Правило**: Обновлять при изменении планов
   - **Синхронизация**: При реализации компонента обновлять статус

### Правила синхронизации кода и документации

**Минимальные требования:**

1. **При изменении публичного API:**
   - Обновить документацию компонента
   - Обновить примеры использования (если есть)
   - Обновить CHANGELOG.md (breaking changes)

2. **При добавлении нового компонента:**
   - Создать документацию компонента
   - Обновить индексные файлы (INDEX.md)
   - Обновить глоссарий (если введены новые термины)

3. **При изменении архитектурного решения:**
   - Обновить соответствующий документ в `docs/architecture/`
   - Обновить roadmap (если применимо)

4. **При изменении правил проекта:**
   - Обновить `docs/project/00-rules-summary.md`
   - Обновить `.cursor/rules/*.mdc` (если применимо)

**Маркировка стабильности:**

- `[CONTRACT]` — стабильный API, breaking changes требуют версионирования
- `[DESIGN]` — экспериментальный дизайн, может измениться
- `[DEPRECATED]` — устаревший компонент, будет удалён в будущей версии

**Автоматизация (для будущего):**

- CI-проверка: при изменении кода проверять, обновлена ли документация
- Link checker: проверка битых ссылок в документации
- Glossary checker: проверка, что все термины из документации есть в глоссарии

---

## Заключение

Документация проекта BioETL представляет собой хорошо структурированную спецификацию для будущей реализации. Основные проблемы связаны с дублированием описаний, неполнотой end-to-end сценариев и отсутствием явного разделения по аудиториям.

Предложенный план рефакторинга направлен на:
1. Консолидацию базовых концепций в единые источники истины
2. Исправление путей и ссылок
3. Заполнение пробелов (глоссарий, примеры, навигация)
4. Реорганизацию структуры по аудиториям
5. Улучшение качества через нормализацию стиля

После выполнения плана документация станет более пригодной для использования как спецификация при реализации кода и как руководство для будущих разработчиков и пользователей системы.

