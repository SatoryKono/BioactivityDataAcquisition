# 01 CLI Commands

## Описание

Документ описывает доступные команды CLI и их использование для запуска пайплайнов обработки данных.

## Базовые команды

### `list`

Выводит список всех зарегистрированных пайплайнов, доступных для запуска через CLI.

```bash
bioetl list
```

### `run-chembl-all`

Запускает все ChEMBL-пайплайны, чьи имена заканчиваются на `_chembl`, с общими опциями для выгрузки и валидации.

```bash
bioetl run-chembl-all [OPTIONS]
```

**Опции:**
- Общие опции для выгрузки данных
- Опции валидации результатов
- Параметры конфигурации

## Команды для отдельных пайплайнов

Для каждого зарегистрированного пайплайна автоматически создаётся отдельная команда. Имя команды формируется на основе имени пайплайна в реестре.

### ChEMBL пайплайны

Для ChEMBL зарегистрированы следующие пайплайны:

- **activity** — обработка данных о биоактивности
- **assay** — обработка данных об экспериментах
- **document** — обработка документов
- **target** — обработка данных о мишенях
- **testitem** — обработка тестовых элементов

**Пример использования:**

```bash
# Запуск пайплайна activity
bioetl run-chembl-activity [OPTIONS]

# Запуск пайплайна assay
bioetl run-chembl-assay [OPTIONS]

# Запуск пайплайна document
bioetl run-chembl-document [OPTIONS]

# Запуск пайплайна target
bioetl run-chembl-target [OPTIONS]

# Запуск пайплайна testitem
bioetl run-chembl-testitem [OPTIONS]
```

## Создание команд для пайплайнов

Команды для пайплайнов создаются функцией `create_pipeline_command` из модуля `cli_command.py`. Эта функция:

1. **Объединяет профили конфигураций** — загружает базовую конфигурацию и применяет профили
2. **Применяет CLI-переопределения** — позволяет переопределять параметры конфигурации через аргументы командной строки
3. **Инстанциирует фабрику пайплайна** — создаёт экземпляр пайплайна с применённой конфигурацией
4. **Обрабатывает исключения** — корректно обрабатывает ошибки и возвращает соответствующие коды выхода

## Реестр пайплайнов

Реестр пайплайнов находится в `cli_registry.py` и централизованно управляет доступностью пайплайнов для CLI. Регистрация пайплайна в реестре автоматически делает его доступным через CLI.

**Зарегистрированные ChEMBL пайплайны:**
- `activity_chembl`
- `assay_chembl`
- `document_chembl`
- `target_chembl`
- `testitem_chembl`

## Коды выхода

CLI возвращает следующие коды выхода:

- `0` — успешное выполнение
- `1` — ошибка выполнения пайплайна
- `2` — ошибка конфигурации
- `3` — ошибка валидации данных

## Конфигурация

Пайплайны используют конфигурационные файлы из `configs/pipelines/<provider>/<entity>.yaml`. CLI позволяет:

- Указывать профиль конфигурации через опции
- Переопределять параметры конфигурации через аргументы командной строки
- Использовать переменные окружения для секретов и настроек

## Примеры использования

### Запуск одного пайплайна

```bash
# Запуск пайплайна activity с конфигурацией по умолчанию
bioetl run-chembl-activity

# Запуск с указанием выходного пути
bioetl run-chembl-activity --output ./data/activity.parquet

# Запуск с профилем конфигурации
bioetl run-chembl-activity --profile production
```

### Запуск всех ChEMBL пайплайнов

```bash
# Запуск всех ChEMBL пайплайнов
bioetl run-chembl-all

# С опциями валидации
bioetl run-chembl-all --validate --strict
```

### Просмотр доступных пайплайнов

```bash
# Список всех зарегистрированных пайплайнов
bioetl list
```

## Related Components

- **cli_app.py**: инициализация приложения и базовые команды
- **cli_command.py**: создание команд для пайплайнов
- **cli_registry.py**: реестр доступных пайплайнов
- **PipelineBase**: базовый класс пайплайнов (см. `docs/02-pipelines/00-pipeline-base.md`)

