# 25 Tracer ABC

## Описание

TracerABC определяет интерфейс трассировки выполнения. Позволяет интегрировать пайплайн с системами трассировки (distributed tracing) или собственным механизмом отслеживания выполнения этапов. Предоставляет методы для обозначения начала/конца важных операций, что упрощает отладку и мониторинг производительности. Он также предоставляет методы для записи времени выполнения операций и счётчиков событий. Реализация может отправлять метрики в различные системы мониторинга (Prometheus, Datadog, CloudWatch) или агрегировать их локально. Метод `start_span()` отмечает начало операции или этапа с трассировочным идентификатором (например, для интеграции с системами distributed tracing). Метод `end_span()` отмечает завершение операции. Имеет продолжительность операции. Реализация может использовать контекстный менеджер для автоматического управления span'ами. Интерфейс не навязывает конкретный формат метрик, но гарантирует, что метрики могут быть записаны и использованы для анализа производительности и диагностики проблем.

## Interface

```python
from abc import ABC, abstractmethod
from typing import Optional, Any

class TracerABC(ABC):
    """Интерфейс трассировки метрик."""
    
    def start_span(self, name: str, context: Optional[dict[str, Any]] = None) -> "SpanContext":
        """Отметить начало операции или этапа с трассировочным идентификатором. Возвращает контекст span'а."""
        raise NotImplementedError
    
    def end_span(self, context: "SpanContext") -> None:
        """Отметить завершение операции. Имеет продолжительность операции."""
        raise NotImplementedError
    
    @abstractmethod
    def record_timing(self, name: str, duration: float) -> None:
        """Записать время выполнения операции."""
        pass

    @abstractmethod
    def record_counter(self, name: str, count: int = 1) -> None:
        """Записать счётчик события."""
        pass
```

## Related Components

- **PipelineHookABC**: может использовать tracer для записи метрик событий
- **SourceClientABC**: может использовать tracer для метрик запросов
- **StageABC**: может использовать tracer для метрик стадий

