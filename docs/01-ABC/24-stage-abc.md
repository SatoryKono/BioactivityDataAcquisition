# 24 Stage ABC

## Описание

StageABC описывает одну стадию конвейера обработки данных. Объект этой абстракции принимает поток элементов типа StageInT и возвращает поток элементов типа StageOutT, не зная о структуре всего пайплайна. Стадия концентрирует локальную бизнес- или техническую логику и может быть переиспользована в разных сценариях. Реализация обязана корректно воспринимать вход как абстрактное Iterable, не полагаясь на конкретную коллекцию и возможность многократной итерации. Исключения, не являющиеся частью ожидаемого бизнес-потока, должны пробрасываться наружу, чтобы оркестрация и политика ошибок могли принять решение. Зависимости стадии (источники, writer'ы, валидаторы, кэши) передаются через конструктор, а не через глобальное состояние, что упрощает тестирование и повторное использование. Стадия не должна самостоятельно управлять жизненным циклом пайплайна и не должна знать о существовании других стадий, кроме как через требования к типу входных данных. При проектировании конкретных стадий рекомендуется явно документировать, какие инварианты предполагаются на уровне входного типа (например, запись уже провалидирована или обогащена), чтобы цепочка стадий оставалась предсказуемой и статически проверяемой.

## Interface

```python
from typing import Generic, TypeVar, Iterable

StageInT = TypeVar("StageInT")
StageOutT = TypeVar("StageOutT")

class StageABC(Generic[StageInT, StageOutT]):
    def process(self, items: Iterable[StageInT]) -> Iterable[StageOutT]:
        """Обработать поток элементов и вернуть результат."""
        raise NotImplementedError
```

## Related Components

- **TransformerABC**: может быть реализацией стадии трансформации
- **ValidatorABC**: может быть реализацией стадии валидации
- **DeduplicatorABC**: может быть реализацией стадии дедупликации
- **PipelineBase**: оркестрирует выполнение стадий

