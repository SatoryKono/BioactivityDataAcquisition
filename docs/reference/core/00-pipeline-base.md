# 00 Pipeline Base

## Назначение
`PipelineBase` задаёт каркас ETL-процесса: управляет порядком стадий, dry-run режимом, метриками и взаимодействием с сервисами логирования и валидации.

## Основные методы
- `run(context)` — orchestration: вызывает prepare_run хуки, затем extract → transform → validate → write, собирает `RunResult`, применяет dry-run.
- `extract()` — использует зарегистрированный клиент для получения данных (итератор/батчи).
- `transform(raw)` — нормализует данные, добавляет служебные поля и хеши.
- `validate(table)` — обращается к `ValidationService` и схемам из `SchemaRegistry`.
- `write(validated)` — передает данные в `UnifiedOutputWriter` для атомарной записи таблиц и артефактов.
- `register_client(client)` — связывает пайплайн с конкретным клиентом данных.
- `close_resources()` — освобождает соединения/кэш после завершения run.

## Внутренняя логика run
- Генерация `run_id`, подготовка контекста и вызов `prepare_run`.
- Пошаговый запуск стадий с измерением метрик и логированием.
- В dry-run режиме стадии write пропускаются, но валидация выполняется.
- Ошибки передаются через ErrorPolicyABC, фиксируются в логах и ValidationResult.

## Хеши и схемы
Метод `_add_hash_columns` вычисляет `hash_business_key` и `hash_row` по детерминированному порядку колонок, используя правила из схем. Это гарантирует воспроизводимость результатов и облегчает QC-сравнения между запусками.
