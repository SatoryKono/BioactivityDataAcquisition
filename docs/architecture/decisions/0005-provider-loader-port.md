# 0005 Provider Loader Port

## Status
Accepted

## Context
Application слой напрямую зависел от инфраструктурного загрузчика провайдеров (`load_provider_registry`), из-за чего нарушались границы слоев и усложнялась миграция на новые реализации. Требуется порт, чтобы держать контракт в domain, адаптер в infrastructure, а сценарии application опирались на протокол и фиче-флаг для обратной совместимости.

## Decision
- Ввести доменный порт `ProviderLoaderProtocol` для загрузки реестра провайдеров.
- Реализовать адаптер `ProviderLoaderImpl` в infrastructure, повторяющий прежнюю логику YAML-лоадера.
- Добавить глобальный фиче-флаг `enable_provider_loader_port` (default: false) в settings, чтобы по умолчанию сохранить старый путь и включать порт постепенно.
- Контейнер и orchestration получают загрузчик через порт; инфраструктурные детали остаются в composition root (CLI/REST/MQ).
- Rollback: выключить фиче-флаг, остаться на прежнем поведении.

## Consequences
- Границы слоев выровнены: domain объявляет контракт, infrastructure дает реализацию, application использует порт.
- Плавное включение через фиче-флаг снижает риск несовместимости.
- Нужны обновления контейнера, orchestrator и фоновых запусков для работы с портом.
- Добавляется покрытие тестами для флага и нового адаптера.

