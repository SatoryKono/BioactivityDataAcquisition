%%{init: {"class": {"domainPrimary": {"fill": "#f5f5f5", "stroke": "#444", "strokeWidth": 1.5, "color": "#111", "fontSize": "22px"}, "domainSecondary": {"fill": "#e3e7ec", "stroke": "#555", "strokeWidth": 1.2, "color": "#111", "fontSize": "18px"}, "interface": {"fill": "#dde7f2", "stroke": "#44546a", "strokeWidth": 1.5, "color": "#111", "fontSize": "22px"}}}}%%
classDiagram-v2

    %% Core Contracts
    class SourceClientABC {
        <<Interface>>
        +fetch_one(id)
        +fetch_many(ids)
        +iter_pages(request)
        +metadata()
    }

    class RequestBuilderABC {
        <<Interface>>
        +build(params)
        +with_pagination(offset, limit)
    }

    class ResponseParserABC {
        <<Interface>>
        +parse(response)
        +extract_metadata(response)
    }

    class ChemblClientHTTPImpl {
        -http_session: ClientSession
        -rate_limiter: RateLimiterABC
        -retry_policy: RetryPolicyABC
        +fetch_one(id)
        +fetch_many(ids)
        +iter_pages(request)
    }

    class ChemblClientFactory {
        +create_client(config) SourceClientABC
        +create_default() SourceClientABC
    }

    SourceClientABC <|-- ChemblClientHTTPImpl
    ChemblClientFactory ..> SourceClientABC : creates
    ChemblClientFactory ..> ChemblClientHTTPImpl : instantiates

    ChemblClientHTTPImpl *-- RequestBuilderABC : uses
    ChemblClientHTTPImpl *-- ResponseParserABC : uses
    ChemblClientHTTPImpl *-- RateLimiterABC : uses
    ChemblClientHTTPImpl *-- RetryPolicyABC : uses

    class ChemblClientHTTPImpl domainPrimary
    class ChemblClientFactory domainSecondary
    class SourceClientABC interface
    class RequestBuilderABC interface
    class ResponseParserABC interface
