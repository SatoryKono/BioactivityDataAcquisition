# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã BioETL

## üìã –°—Ç–∞—Ç—É—Å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –ü—Ä–∏–Ω—è—Ç—ã –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (`docs/project/01-project-rules.md`).
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å**: –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å Hexagonal Architecture + DDD –∏ –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è/—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: Zero-sum class count (—É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä–æ–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ).

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Ports & Adapters)

### –°–ª–æ–∏
1.  **Domain** (`src/bioetl/domain/`)
    *   `contracts/` (ABCs/Protocols —Å —Å—É—Ñ—Ñ–∏–∫—Å–∞–º–∏ `ABC`/`Protocol`)
    *   `schemas/` (Pandera —Å—Ö–µ–º—ã)
    *   `models/` (Pydantic –º–æ–¥–µ–ª–∏)
2.  **Application** (`src/bioetl/application/`)
    *   `pipelines/<provider>/<entity>/` (Extract -> Transform -> Validate -> Export)
    *   `services/` (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)
3.  **Infrastructure** (`src/bioetl/infrastructure/`)
    *   `impl/` (–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ABC —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `Impl`)
    *   `clients/` (UnifiedAPIClient –∏ –µ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏)
    *   `logging/` (UnifiedLogger)
4.  **Interfaces** (`src/bioetl/interfaces/`)
    *   `cli/` (Typer commands)

## üìÖ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ü—Ä–∞–≤–∏–ª–∞ (Completed/In Progress)
- [x] –û–±–Ω–æ–≤–∏—Ç—å `01-project-rules.md` –∏ `.cursor/rules/`.
- [ ] **Audit Naming**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–ª–∞—Å—Å—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å–∞–º (`*Factory`, `*Client`, `*Impl`, `*ABC`).
- [ ] **Audit Files**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `kebab-case` —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `NN-`.
- [ ] **Config Check**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ `configs/` –∏–º–µ—é—Ç Pydantic-–º–æ–¥–µ–ª–∏.

### –§–∞–∑–∞ 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ë–∞–∑–æ–≤—ã—Ö –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Core Refactoring)
*–¶–µ–ª—å: –í—ã–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ —É–±—Ä–∞—Ç—å –∂–µ—Å—Ç–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.*

1.  **Clients Layer**:
    *   –í—ã–¥–µ–ª–∏—Ç—å `DataClientABC` –≤ domain.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ChemblDataClientHTTPImpl` —á–µ—Ä–µ–∑ `UnifiedAPIClient`.
    *   –°–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É `default_chembl_client()`.
2.  **Pipeline Layer**:
    *   –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ `PipelineBase` –≤ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: `ExtractorABC`, `TransformerABC`, `LoaderABC`.
    *   –û–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –ø–∞–π–ø–ª–∞–π–Ω (`application/pipelines/...`) —Å–æ–±–∏—Ä–∞–ª—Å—è —á–µ—Ä–µ–∑ Factory.

### –§–∞–∑–∞ 2b: CI/CD –∏ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ü–æ—Ä—Ç–æ–≤ (Enforcement)
*–¶–µ–ª—å: –ó–∞—â–∏—Ç–∏—Ç—å –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é —Ä–µ–µ—Å—Ç—Ä–∞ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ –ø–∞–π–ø–ª–∞–π–Ω.*

1.  **Lint & Static**:
    *   –ó–∞–ø—É—Å—Ç–∏—Ç—å `ruff`, `black`, `isort` –∏ `mypy` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º CI-—Å—Ç–µ–π–¥–∂–µ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏.
    *   –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ç–µ—Å—Ç `tests/architecture/test_layer_dependencies.py` –∏ `import-linter` –≤ —Ç–æ—Ç –∂–µ —Å—Ç–µ–π–¥–∂.
2.  **Docs & Ports**:
    *   –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ CI (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ü–µ–ª–∏ `docs`/`docs-html` –∫–∞–∫ –µ–¥–∏–Ω—ã–π entrypoint).
    *   –ü–æ–¥–≤—è–∑–∞—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é ABC/–ø–æ—Ä—Ç–æ–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `docs/ABC_INDEX.md` –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è `abc_registry.yaml`/`abc_impls.yaml`) –∫ doc-—Ü–µ–ª—è–º, —á—Ç–æ–±—ã –ø–∞–π–ø–ª–∞–π–Ω –ø–∞–¥–∞–ª –ø—Ä–∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
3.  **–ì–µ–π—Ç—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**:
    *   –°–¥–µ–ª–∞—Ç—å —Å—Ç–µ–π–¥–∂ –±–ª–æ–∫–∏—Ä—É—é—â–∏–º –¥–ª—è –∑–∞–¥–∞—á –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ä–µ–µ—Å—Ç—Ä–∞ –∏ rollout –ø–æ—Ä—Ç–æ–≤ (–ø–æ—Ä—Ç-–∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–µ –º—ë—Ä–∂–∞—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç lint/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏).

### –§–∞–∑–∞ 3: –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è (Reliability)
*–¶–µ–ª—å: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏—Ç-–≤-–±–∏—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å.*

1.  **Pandera Everywhere**:
    *   –ü–æ–∫—Ä—ã—Ç—å –≤—Å–µ `output` –¥–∞—Ç–∞—Ñ—Ä–µ–π–º—ã —Å—Ö–µ–º–∞–º–∏.
    *   –í–Ω–µ–¥—Ä–∏—Ç—å `validate_before_write` –ø–æ–ª–∏—Ç–∏–∫—É.
2.  **Atomic Writes**:
    *   –í–Ω–µ–¥—Ä–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É `atomic_write(path, content)` (temp -> rename).
    *   –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é `meta.yaml` (checksums, row_counts) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞.
3.  **Testing**:
    *   –î–æ–±–∞–≤–∏—Ç—å Golden-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π.

### –§–∞–∑–∞ 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Performance)
1.  **Vectorization**: –ó–∞–º–µ–Ω–∏—Ç—å row-by-row `apply` –Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ pandas/numpy.
2.  **Parallelism**: –í–Ω–µ–¥—Ä–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –±–∞—Ç—á–µ–π —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

## üõ†Ô∏è –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (New Style)

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç (Domain)
```python
# src/bioetl/domain/normalization/contracts.py
class NormalizationStrategyABC(ABC):
    @abstractmethod
    def normalize(self, value: Any) -> Any: ...
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (Infrastructure)
```python
# src/bioetl/infrastructure/normalization/impl.py
class ChemblIdNormalizerImpl(NormalizationStrategyABC):
    def normalize(self, value: Any) -> str:
        # implementation
        return normalized_val
```

### –§–∞–±—Ä–∏–∫–∞ (Application/Infra)
```python
# src/bioetl/infrastructure/normalization/factories.py
def default_normalizer_factory(dtype: str) -> NormalizationStrategyABC:
    if dtype == "chembl_id":
        return ChemblIdNormalizerImpl()
    # ...
```

## üìâ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –∫ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é
- [ ] –£–¥–∞–ª–∏—Ç—å –∂–µ—Å—Ç–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `requests` –∏–∑ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.
- [ ] –£–±—Ä–∞—Ç—å `print()` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `UnifiedLogger`.
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –≤ –∏–µ—Ä–∞—Ä—Ö–∏—é Pydantic-–º–æ–¥–µ–ª–µ–π.
